<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Misi√≥n</title>
  <style>
    :root{
      --bg:#000;
      --green:#00ff66;
      --glow: 0 0 8px rgba(0,255,102,.55), 0 0 24px rgba(0,255,102,.25);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    html,body{height:100%; margin:0; background:var(--bg); color:var(--green); font-family:var(--mono);}

    /* ===== MATRIX CANVAS ===== */
    #matrix{
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      opacity: 0.25;
    }

    /* Scanlines */
    body::before{
      content:"";
      position:fixed; inset:0;
      background:repeating-linear-gradient(
        to bottom,
        rgba(0,255,102,.05),
        rgba(0,255,102,.05) 1px,
        rgba(0,0,0,0) 3px,
        rgba(0,0,0,0) 6px
      );
      pointer-events:none;
      z-index:1;
    }

    /* Vi√±eta */
    body::after{
      content:"";
      position:fixed; inset:-40px;
      background:radial-gradient(circle at center, rgba(0,0,0,0) 0%, rgba(0,0,0,.75) 70%, rgba(0,0,0,.95) 100%);
      pointer-events:none;
      z-index:2;
    }

    .wrap{
      min-height:100%;
      display:flex;
      justify-content:center;
      padding:24px;
      position:relative;
      z-index:3;
    }

    .terminal{
      width:min(920px,100%);
      border:1px solid rgba(0,255,102,.25);
      box-shadow:var(--glow);
      background:rgba(0,0,0,.65);
      border-radius:14px;
      overflow:hidden;
    }

    .bar{
      display:flex;
      gap:8px;
      align-items:center;
      padding:10px 14px;
      border-bottom:1px solid rgba(0,255,102,.18);
      background:rgba(0,0,0,.85);
    }
    .dot{width:10px;height:10px;border-radius:99px;background:rgba(0,255,102,.35);}
    .title{margin-left:auto;font-size:12px;color:rgba(0,255,102,.7)}

    .screen{
      padding:16px;
      font-size:16px;
      line-height:1.35;
      white-space:pre-wrap;
      text-shadow:var(--glow);
      max-height:75vh;
      overflow-y:auto;
      scroll-behavior:smooth;
    }

    .cursor{
      display:inline-block;
      width:10px;
      margin-left:2px;
      background:var(--green);
      box-shadow:var(--glow);
      animation:blink 1s step-end infinite;
      height:1em;
    }
    @keyframes blink{50%{opacity:0}}

    .hint{
      margin-top:12px;
      text-align:center;
    }

    .btn{
      display:inline-block;
      margin:6px;
      padding:10px 16px;
      border:1px solid rgba(0,255,102,.25);
      border-radius:10px;
      color:rgba(0,255,102,.9);
      background:rgba(0,0,0,.55);
      text-decoration:none;
      font-size:12px;
    }

    #geoStatus{
      margin-top:8px;
      font-size:12px;
      color:rgba(0,255,102,.8);
    }
  </style>
</head>
<body>

<canvas id="matrix"></canvas>

<div class="wrap">
  <div>
    <div class="terminal">
      <div class="bar">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        <span class="title">SECURE CONSOLE ‚Ä¢ v1.0</span>
      </div>
      <div class="screen" id="screen"></div>
    </div>

    <div class="hint">
      <a href="#" class="btn" id="replay" style="display:none;">Recargar</a>
      <a href="#" class="btn" id="checkin" style="display:none;">C</a>
      <div id="geoStatus"></div>
    </div>
  </div>
</div>

<script>
/* ===================== MENSAJE ===================== */
const LINES = [
  ">> Conexi√≥n establecida...",
  ">> Verificando identidad...",
  ">> Acceso concedido.",
  "",
  ">> MISI√ìN: OPERACI√ìN EL D√âCIMO LATIDO",
  ">> OBJETIVO: Lean con atenci√≥n todas las pistas que recibir√°n.",
  "",
  ">> INSTRUCCIONES:",
  "    Ma√±ana es un d√≠a muy especial,",
  "    necesitamos que se ba√±en,",
  "    aunque ya lo hayan hecho ayer Jaeluchis,",
  "    dep√≠late bien la entrepierna Armando,",
  "    y perj√∫mensen para estar listos temprano,",
  "    no pierdan tiempo en nada m√°s,",
  "    pase lo que pase sigan el plan,",
  "    no importa si ya tienen compromiso‚Ä¶",
  "    ¬°LO CANCELAN!",
  "    no pidan ayuda de nadie,",
  "    pueden documentarlo todo o guardarlo en su coraz√≥n.",
  "",
  ">> PISTA:",
  "    ** Agua pasa por mi casa,",
  "    ** cate de mi coraz√≥n,",
  "    ** el s√°bado 7 de febrero,",
  "    ** a las 10 de la ma√±ana,",
  "    ** la casa de los abuelos parece ser una buena opci√≥n.",
  "",
  ">> Para continuar, valida tu ubicaci√≥n.",
  "",
  ">> Fin de transmisi√≥n."
];

/* ===================== VELOCIDAD ===================== */
const TYPE_SPEED = 55;
const LINE_DELAY = 450;
const BOOT_DELAY = 650;

/* ===================== GEO CONFIG ===================== */
const CHECKPOINT_LAT = 20.569797358584086;
const CHECKPOINT_LNG = -100.43792650174372;
const RADIUS_METERS = 300;

const DEST_LAT = 20.741390770729424;
const DEST_LNG = -99.94134044852143;

/* ===================== TERMINAL ===================== */
const screen = document.getElementById("screen");
const replayBtn = document.getElementById("replay");
const checkinBtn = document.getElementById("checkin");
const geoStatus = document.getElementById("geoStatus");

function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }
function scrollToBottom(){ screen.scrollTop = screen.scrollHeight; }

async function typeAll(){
  replayBtn.style.display = "none";
  checkinBtn.style.display = "none";
  geoStatus.textContent = "";
  screen.textContent = "";
  const cursor = document.createElement("span");
  cursor.className = "cursor";
  screen.appendChild(cursor);

  await sleep(BOOT_DELAY);

  for(const line of LINES){
    for(let i=0;i<line.length;i++){
      cursor.insertAdjacentText("beforebegin", line[i]);
      scrollToBottom();
      await sleep(TYPE_SPEED + Math.random()*12);
    }
    cursor.insertAdjacentText("beforebegin", "\n");
    scrollToBottom();
    await sleep(LINE_DELAY);
  }

  replayBtn.style.display = "inline-block";
  checkinBtn.style.display = "inline-block";
}

/* ===================== GEO ===================== */
function toRad(deg){ return deg * Math.PI / 180; }
function distanceMeters(lat1, lon1, lat2, lon2){
  const R = 6371000;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a =
    Math.sin(dLat/2)**2 +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
    Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

// üü¢ MENSAJE CINEM√ÅTICO + REDIRECCI√ìN
async function openGoogleMaps(){
  const confirmLines = [
    "",
    ">> CHECKPOINT CONFIRMADO.",
    ">> LOS DEL D√âCIMO LATIDO HAN PASADO LA PRUEBA.",
    ">> COORDENADAS DESBLOQUEADAS..."
  ];

  for (const line of confirmLines) {
    for (let i = 0; i < line.length; i++) {
      screen.insertAdjacentText("beforeend", line[i]);
      scrollToBottom();
      await sleep(TYPE_SPEED + Math.random() * 12);
    }
    screen.insertAdjacentText("beforeend", "\n");
    scrollToBottom();
    await sleep(LINE_DELAY);
  }

  await sleep(2000);

  const url = `https://www.google.com/maps/dir/?api=1&destination=${DEST_LAT},${DEST_LNG}&travelmode=driving`;
  window.location.href = url;
}

checkinBtn.addEventListener("click", e => {
  e.preventDefault();
  geoStatus.textContent = ">> Solicitando ubicaci√≥n...";

  if(!navigator.geolocation){
    geoStatus.textContent = ">> Geolocalizaci√≥n no soportada.";
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    const {latitude, longitude} = pos.coords;
    const dist = distanceMeters(latitude, longitude, CHECKPOINT_LAT, CHECKPOINT_LNG);

    if(dist <= RADIUS_METERS){
      geoStatus.textContent = ">> Checkpoint confirmado.";
      openGoogleMaps();
    } else {
      geoStatus.textContent = `>> A√∫n no est√°s en el punto. Distancia: ~${Math.round(dist)}m`;
    }
  }, err => {
    geoStatus.textContent = ">> No se pudo obtener la ubicaci√≥n. Permiso denegado o se√±al d√©bil.";
  }, {
    enableHighAccuracy:true,
    timeout:10000,
    maximumAge:0
  });
});

/* ===================== BOTONES ===================== */
replayBtn.addEventListener("click", e => {
  e.preventDefault();
  typeAll();
});

/* ===================== MATRIX ===================== */
const canvas = document.getElementById("matrix");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

const letters = "„Ç¢„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É©„ÉØ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ$#@";
const fontSize = 18;
let columns = Math.floor(canvas.width / fontSize);
let drops = Array(columns).fill(1);

function drawMatrix(){
  ctx.fillStyle = "rgba(0,0,0,0.08)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "#00ff66";
  ctx.font = fontSize + "px monospace";

  for(let i=0;i<drops.length;i++){
    const text = letters[Math.floor(Math.random()*letters.length)];
    ctx.fillText(text, i*fontSize, drops[i]*fontSize);

    if(drops[i]*fontSize > canvas.height && Math.random() > 0.975){
      drops[i] = 0;
    }
    drops[i]++;
  }
}
setInterval(drawMatrix, 40);

/* ===================== START ===================== */
typeAll();
</script>
</body>
</html>
